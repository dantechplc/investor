{% extends "transaction/dsh/base.html" %}
{% block content %}
    <div class="content-page">
        <div class="container-fluid">
            <div class="col-lg-12 col-12 iq-card shadow-sm border-0 rounded">
                <div class="box">
                    <div class="box-header with-border">
                        <h4 class="box-title pt-3 text-primary">
                            <i class="fa fa-id-card me-2"></i> Identity Verification Form
                        </h4>
                        <p class="text-muted mb-0">All fields are required. Kindly ensure the information matches your legal documents.</p>
                    </div>
                    <form class="form" method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <!-- Show general form errors -->
                        {% if form.errors %}
                            <div class="alert alert-danger mt-3">
                                <ul class="mb-0">
                                    {% for field, errors in form.errors.items %}
                                        {% for error in errors %}<li>{{ error }}</li>{% endfor %}
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}
                        <div class="box-body">
                            <!-- Personal Info -->
                            <h5 class="text-primary mt-3">
                                <i class="fa fa-user me-2"></i> Personal Information
                            </h5>
                            <hr>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">First Name</label>
                                    <input required
                                           type="text"
                                           name="first_name"
                                           value="{{ form.first_name.value|default:'' }}"
                                           class="form-control"
                                           placeholder="Enter first name">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Last Name</label>
                                    <input required
                                           type="text"
                                           name="last_name"
                                           value="{{ form.last_name.value|default:'' }}"
                                           class="form-control"
                                           placeholder="Enter last name">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Date of Birth</label>
                                    <input required
                                           type="date"
                                           name="dob"
                                           value="{{ form.dob.value|default:'' }}"
                                           class="form-control">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Gender</label>
                                    {{ form.gender }}
                                </div>
                            </div>
                            <!-- Address Info -->
                            <h5 class="text-primary mt-4">
                                <i class="fa fa-map-marker me-2"></i> Address Information
                            </h5>
                            <hr>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Town/City</label>
                                    <input required
                                           type="text"
                                           name="town_city"
                                           value="{{ form.town_city.value|default:'' }}"
                                           class="form-control"
                                           placeholder="Enter your city">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">State</label>
                                    <input required
                                           type="text"
                                           name="state"
                                           value="{{ form.state.value|default:'' }}"
                                           class="form-control"
                                           placeholder="Enter your state">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Address</label>
                                    <textarea required
                                              name="address"
                                              class="form-control"
                                              rows="2"
                                              placeholder="Enter full address">{{ form.address.value|default:'' }}</textarea>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Postcode/Zipcode</label>
                                    <input required
                                           type="text"
                                           name="postcode"
                                           value="{{ form.postcode.value|default:'' }}"
                                           class="form-control"
                                           placeholder="Enter postcode/zipcode">
                                </div>
                            </div>
                            <!-- Document Info -->
                            <h5 class="text-primary mt-4">
                                <i class="fa fa-id-badge me-2"></i> Identity Document
                            </h5>
                            <hr>
                            <div class="mb-3">
                                <label class="form-label">Select Document Type</label>
                                {{ form.document_type }}
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Upload ID Front View</label>
                                {{ form.id_front_view }}
                                <div class="mt-2">
                                    <img id="frontPreview"
                                         src="#"
                                         alt="Front Preview"
                                         class="img-thumbnail d-none"
                                         width="200">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Upload ID Back View</label>
                                {{ form.id_back_view }}
                                <div class="mt-2">
                                    <img id="backPreview"
                                         src="#"
                                         alt="Back Preview"
                                         class="img-thumbnail d-none"
                                         width="200">
                                </div>
                            </div>
                        </div>
                        <!-- Submit -->
                        <div class="box-footer">
                            <button type="submit" class="btn btn-primary col-12">
                                <i class="fa fa-save"></i> Submit Verification
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Image Preview Script -->
    <script>
document.addEventListener("DOMContentLoaded", function () {
  function previewFile(input, previewId) {
    const file = input.files[0];
    const preview = document.getElementById(previewId);
    if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        preview.src = e.target.result;
        preview.classList.remove("d-none");
      };
      reader.readAsDataURL(file);
    }
  }

  document.querySelector("[name='id_front_view']").addEventListener("change", function() {
    previewFile(this, "frontPreview");
  });

  document.querySelector("[name='id_back_view']").addEventListener("change", function() {
    previewFile(this, "backPreview");
  });
});
    </script>
{% endblock content %}
